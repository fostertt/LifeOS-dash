# Session Summary: 2026-02-22

## What Was Done

### ADR-017: Unscheduled Section (Today View)
- **API** (`app/api/calendar/items/route.ts`): Added `undated` bucket — active tasks with no `dueDate` at all
- **Interface**: Added `undated: Item[]` to `CategorizedCalendarData`
- **Timeline view**: Replaced "Scheduled (No Time)" with "Unscheduled" section combining `scheduledNoTime` (today's date, no time) + `undated` (completely undated active tasks)
- Section is collapsible using existing toggle pattern; key is "Unscheduled"
- Empty state check and drag source list updated to include `undated`

### UX-010: Pin Bottom Panel in Note/List Editors
- **Files**: `app/vault/notes/[id]/page.tsx`, `app/vault/lists/[id]/page.tsx`
- Changed root container from `min-h-screen` → `fixed inset-0 flex flex-col overflow-hidden`
- Content (title, body/items) is `flex-1 overflow-y-auto` — scrolls independently
- Bottom panel (color swatches, tags, pin toggle, Save/Delete) is `flex-shrink-0` — always visible at viewport bottom
- `pb-16 md:pb-4` on bottom panel clears the BottomTabBar on mobile
- Pin toggle and action buttons consolidated into one row (space savings)

### UX-009: Complete Button in Task Edit Modal
- Added `isCompleted?: boolean` to `TaskForm` existingTask interface
- Compact "Complete" / "Done" button in modal header row (edit mode only, tasks/reminders only — not habits)
- Clicking calls `/api/items/{id}/toggle` immediately and closes modal
- `onClose` in calendar page's TaskForm now calls `loadData()` so completion is reflected immediately

### UX-008: Pin to Today Mobile Overflow Fix
- `components/TaskForm.tsx`: Replaced "Pin to Today" checkbox+label (off-screen on mobile when next to recurrence dropdown) with compact bookmark icon button
- Active state: filled purple bookmark. Inactive: outline gray. Same `showOnCalendar` state.

---

## Bugs Identified (Not Yet Fixed)

See `docs/notes/bugs.md` for full details. Three bugs were identified and documented at the end of session:

1. **Today view checkboxes open edit modal** — `stopPropagation` is on `onChange` not `onClick`; click event bubbles to parent card before change fires
2. **Weekly recurring task won't complete** — toggle route, renderItemCard, and completions API all use `scheduleType` (habit field) to detect recurring, missing tasks with `recurrenceType: "weekly"`
3. **All view requires pull-to-refresh after completing** — `loadData()` calls `setLoading(true)` causing full list flicker; no optimistic update in `toggleCompletion`

---

## Key Files Changed This Session
- `app/api/calendar/items/route.ts` — undated bucket
- `app/calendar/page.tsx` — Unscheduled section, Complete button wiring
- `app/vault/notes/[id]/page.tsx` — pinned bottom panel
- `app/vault/lists/[id]/page.tsx` — pinned bottom panel
- `components/TaskForm.tsx` — Complete button, Pin to Today icon button

## Commits
- `de3732a` ADR-017: Add Unscheduled section to Today view
- `4b6e51e` UX-010: Pin bottom panel to viewport in note/list editors
- `1d3b979` UX-009: Add Complete button in task edit modal header
- `7dfa83f` UX-008: Replace Pin to Today checkbox with compact icon button

## Next Session Should Start With
Fix the 3 bugs documented above — all have clear root causes and fix directions in `bugs.md`.
